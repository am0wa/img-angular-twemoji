/**
 * Created by Andrew Mur. on 2015 Oct 16 18:23
 */
'use strict';
angular.module('am.imgtwemoji', [])
    .provider('imgtwemoji', function imgTwemojiProvider() {
        var self = this;

        //----------------------------------------
        // defaults
        //----------------------------------------
        self.opts = {
            base: (location.protocol === 'https:' ? 'https:' : 'http:') +
            '//twemoji.maxcdn.com/',
            ext: ".svg",
            folder: 'svg',
            // 'size'  has no impact in twemoji: for svg size should be defined via css(
            // here size will be applied to svg, css overrides it if defined
            // if you need 'rem/em' for svg instead of 'px' you can define 'width' and 'height' as directly in options.
            size: "72x72",
            // default class name, by default 'img-twemoji'
            className: 'img-twemoji',
            // make it not draggable by default
            draggable: false,
            // use emojiToUnicode
            emojiToUnicode: true
        };
        retrieveWidthHeightFromSize(self.opts);

        //----------------------------------------
        // public
        //----------------------------------------
        this.$get = function ($window, emojiToUnicode) {

            self.parse = function (input, opts) {
                opts = angular.isUndefined(opts)
                    ? self.opts
                    : self.getOptionsWithDefaults(opts);

                if (opts.emojiToUnicode) {
                    input = emojiToUnicode(input);
                }

                var result = $window.twemoji.parse(findToParse(input), opts);
                return replaceSize(result, opts);
            };

            self.toCodePoint = function (unicodeSurrogates, sep) {
                return $window.twemoji.convert.toCodePoint(unicodeSurrogates, sep);
            };

            return self;
        };

        self.setOptions = function (opts) {
            // rewrite only defined params
            self.opts = self.getOptionsWithDefaults(opts);
        };

        self.getOptionsWithDefaults = function (opts) {
            // retrieve opt width & height from size
            // to not be overridden by defaults
            retrieveWidthHeightFromSize(opts);
            // retrieve not defined params from defaults
            for (var p in self.opts) {
                if (!opts.hasOwnProperty(p)) {
                    opts[p] = self.opts[p];
                }
            }
            return opts;
        };

        //----------------------------------------
        // private
        //----------------------------------------

        function findToParse(input) {
            return angular.isElement(input) ? input[0] : input;
        }

        function retrieveWidthHeightFromSize(opts) {
            if (!angular.isUndefined(opts.width) && !angular.isUndefined(opts.height)) {
                return;
            }
            if (angular.isUndefined(opts.size)) {
                return;
            }

            var matches = opts.size.match(/\d+/g);
            if (matches !== null) {
                opts.width = matches[0] + "px";
                opts.height = matches[1] + "px";
            }
        }

        function replaceSize(str, opts) {
            retrieveWidthHeightFromSize(opts);
            // string between '<img' and the closest '>'
            var matches = str.match(/\<img.[^<]*>/g);
            var len = matches ? matches.length : 0;
            // adds specified width & height to each img node
            for (var i = 0; i < len; i++) {
                str = String(str).split(matches[i]).join(replaceItemSize(matches[i], opts));
            }
            return str;
        }

        function replaceItemSize(str, opts) {
            return String(str).replace(">", " width=" + opts.width + " height=" + opts.height + ">");
        }

        return self;
    })
    .directive('imgTwemoji', function (imgtwemoji, emojiToUnicode) {
        return {
            restrict: 'EA',
            template: '<img ng-src="{{getTwemoji()}}" width="{{getWidth()}}" height="{{getHeight()}}" class="{{getClass()}}" draggable="{{getDraggable()}}"/>',
            templateNamespace: 'html',
            //create the directive own scope
            scope: {
                code: "@",
                size: '@',
                width: '@',
                height: '@',
                class: '@',
                draggable: '@'
            },
            link: function ($scope, elem) {
                var opt = imgtwemoji.getOptionsWithDefaults($scope);

                $scope.getTwemoji = function () {
                    return opt.base
                        + opt.folder + '/'
                        + grabRightIcon()
                        + opt.ext
                };
                $scope.getWidth = function () {
                    return opt.width;
                };
                $scope.getHeight = function () {
                    return opt.height;
                };
                $scope.getClass = function () {
                    return angular.isUndefined(opt.class)
                        ? opt.className
                        : opt.class;
                };
                $scope.getDraggable = function () {
                    return opt.draggable;
                };
                function grabRightIcon() {
                    if (opt.emojiToUnicode) {
                        opt.code = emojiToUnicode(opt.code);
                    }
                    return imgtwemoji.toCodePoint(opt.code);
                }
            }
        }
    })
    .filter('imgtwemoji', ['imgtwemoji', '$sce', function (imgtwemoji, $sce) {
        return function (input, size) {
            //$sce allows ng-bind-html to insert in safe context
            return !angular.isUndefined(size)
                ? $sce.trustAsHtml(imgtwemoji.parse(input, {size: size}))
                : $sce.trustAsHtml(imgtwemoji.parse(input));
        };
    }])
    .factory('emojiToUnicode', ['emojiMap', function(emojiMap) {
        return function(str) {
            return EmojiService(emojiMap, str);
        };
    }])
    .filter('emojiToUnicode', ['emojiMap', function(emojiMap) {
        return function(str) {
            return EmojiService(emojiMap, str);
        };
    }])
	// Taken from https://github.com/mmattax/angular-emoji-map
    .constant('emojiMap', {
        ':smile:': '\ud83d\ude04',
        ':laughing:': '\ud83d\ude06',
        ':blush:': '\ud83d\ude0a',
        ':smiley:': '\ud83d\ude03',
        ':relaxed:': '\u263a',
        ':smirk:': '\ud83d\ude0f',
        ':heart_eyes:': '\ud83d\ude0d',
        ':kissing_heart:': '\ud83d\ude18',
        ':kissing_closed_eyes:': '\ud83d\ude1a',
        ':flushed:': '\ud83d\ude33',
        ':relieved:': '\ud83d\ude25',
        ':satisfied:': '\ud83d\ude0c',
        ':grin:': '\ud83d\ude01',
        ':wink:': '\ud83d\ude09',
        ':stuck_out_tongue_winking_eye:': '\ud83d\ude1c',
        ':stuck_out_tongue_closed_eyes:': '\ud83d\ude1d',
        ':grinning:': '\ud83d\ude00',
        ':kissing:': '\ud83d\ude17',
        ':kissing_smiling_eyes:': '\ud83d\ude19',
        ':stuck_out_tongue:': '\ud83d\ude1b',
        ':sleeping:': '\ud83d\ude34',
        ':worried:': '\ud83d\ude1f',
        ':frowning:': '\ud83d\ude26',
        ':anguished:': '\ud83d\ude27',
        ':open_mouth:': '\ud83d\ude2e',
        ':grimacing:': '\ud83d\ude2c',
        ':confused:': '\ud83d\ude15',
        ':hushed:': '\ud83d\ude2f',
        ':expressionless:': '\ud83d\ude11',
        ':unamused:': '\ud83d\ude12',
        ':sweat_smile:': '\ud83d\ude05',
        ':sweat:': '\ud83d\ude13',
        ':weary:': '\ud83d\ude29',
        ':pensive:': '\ud83d\ude14',
        ':disappointed:': '\ud83d\ude1e',
        ':confounded:': '\ud83d\ude16',
        ':fearful:': '\ud83d\ude28',
        ':cold_sweat:': '\ud83d\ude30',
        ':persevere:': '\ud83d\ude23',
        ':cry:': '\ud83d\ude22',
        ':sob:': '\ud83d\ude2d',
        ':joy:': '\ud83d\ude02',
        ':astonished:': '\ud83d\ude32',
        ':scream:': '\ud83d\ude31',
        ':tired_face:': '\ud83d\ude2b',
        ':angry:': '\ud83d\ude20',
        ':rage:': '\ud83d\ude21',
        ':triumph:': '\ud83d\ude24',
        ':sleepy:': '\ud83d\ude2a',
        ':yum:': '\ud83d\ude0b',
        ':mask:': '\ud83d\ude37',
        ':sunglasses:': '\ud83d\ude0e',
        ':dizzy_face:': '\ud83d\ude35',
        ':imp:': '\ud83d\udc7f',
        ':smiling_imp:': '\ud83d\ude08',
        ':neutral_face:': '\ud83d\ude10',
        ':no_mouth:': '\ud83d\ude36',
        ':innocent:': '\ud83d\ude07',
        ':alien:': '\ud83d\udc7d',
        ':yellow_heart:': '\ud83d\udc9b',
        ':blue_heart:': '\ud83d\udc99',
        ':purple_heart:': '\ud83d\udc9c',
        ':heart:': '\u2764',
        ':green_heart:': '\ud83d\udc9a',
        ':broken_heart:': '\ud83d\udc94',
        ':heartbeat:': '\ud83d\udc93',
        ':heartpulse:': '\ud83d\udc97',
        ':two_hearts:': '\ud83d\udc95',
        ':revolving_hearts:': '\ud83d\udc9e',
        ':cupid:': '\ud83d\udc98',
        ':sparkling_heart:': '\ud83d\udc96',
        ':sparkles:': '\u2728',
        ':star:': '\u2b50',
        ':star2:': '\ud83c\udf1f',
        ':dizzy:': '\ud83d\udcab',
        ':boom:': '\ud83d\udca5',
        ':anger:': '\ud83d\udca2',
        ':exclamation:': '\u2757',
        ':question:': '\u2753',
        ':grey_exclamation:': '\u2755',
        ':grey_question:': '\u2754',
        ':zzz:': '\ud83d\udca4',
        ':dash:': '\ud83d\udca8',
        ':sweat_drops:': '\ud83d\udca6',
        ':notes:': '\ud83c\udfb6',
        ':musical_note:': '\ud83c\udfb5',
        ':fire:': '\ud83d\udd25',
        ':poop:': '\ud83d\udca9',
        ':thumbsup:': '\ud83d\udc4d',
        ':thumbsdown:': '\ud83d\udc4e',
        ':ok_hand:': '\ud83d\udc4c',
        ':punch:': '\ud83d\udc4a',
        ':fist:': '\u270a',
        ':v:': '\u270c',
        ':wave:': '\ud83d\udc4b',
        ':hand:': '\u270b',
        ':open_hands:': '\ud83d\udc50',
        ':point_up:': '\u261d',
        ':point_down:': '\ud83d\udc47',
        ':point_left:': '\ud83d\udc48',
        ':point_right:': '\ud83d\udc49',
        ':raised_hands:': '\ud83d\ude4c',
        ':pray:': '\ud83d\ude4f',
        ':point_up_2:': '\ud83d\udc46',
        ':clap:': '\ud83d\udc4f',
        ':muscle:': '\ud83d\udcaa',
        ':walking:': '\ud83d\udeb6',
        ':runner:': '\ud83c\udfc3',
        ':couple:': '\ud83d\udc6b',
        ':family:': '\ud83d\udc6a',
        ':two_men_holding_hands:': '\ud83d\udc6c',
        ':two_women_holding_hands:': '\ud83d\udc6d',
        ':dancer:': '\ud83d\udc83',
        ':dancers:': '\ud83d\udc6f',
        ':ok_woman:': '\ud83d\ude46',
        ':no_good:': '\ud83d\ude45',
        ':information_desk_person:': '\ud83d\udc81',
        ':raised_hand:': '\ud83d\ude4b',
        ':bride_with_veil:': '\ud83d\udc70',
        ':person_with_pouting_face:': '\ud83d\ude4e',
        ':person_frowning:': '\ud83d\ude4d',
        ':bow:': '\ud83d\ude47',
        ':couplekiss:': '\ud83d\udc8f',
        ':couple_with_heart:': '\ud83d\udc91',
        ':massage:': '\ud83d\udc86',
        ':haircut:': '\ud83d\udc87',
        ':nail_care:': '\ud83d\udc85',
        ':boy:': '\ud83d\udc66',
        ':girl:': '\ud83d\udc67',
        ':woman:': '\ud83d\udc69',
        ':man:': '\ud83d\udc68',
        ':baby:': '\ud83d\udc76',
        ':older_woman:': '\ud83d\udc75',
        ':older_man:': '\ud83d\udc74',
        ':person_with_blond_hair:': '\ud83d\udc71',
        ':man_with_gua_pi_mao:': '\ud83d\udc72',
        ':man_with_turban:': '\ud83d\udc73',
        ':construction_worker:': '\ud83d\udc77',
        ':cop:': '\ud83d\udc6e',
        ':angel:': '\ud83d\udc7c',
        ':princess:': '\ud83d\udc78',
        ':smiley_cat:': '\ud83d\ude3a',
        ':smile_cat:': '\ud83d\ude38',
        ':heart_eyes_cat:': '\ud83d\ude3b',
        ':kissing_cat:': '\ud83d\ude3d',
        ':smirk_cat:': '\ud83d\ude3c',
        ':scream_cat:': '\ud83d\ude40',
        ':crying_cat_face:': '\ud83d\ude3f',
        ':joy_cat:': '\ud83d\ude39',
        ':pouting_cat:': '\ud83d\ude3e',
        ':japanese_ogre:': '\ud83d\udc79',
        ':japanese_goblin:': '\ud83d\udc7a',
        ':see_no_evil:': '\ud83d\ude48',
        ':hear_no_evil:': '\ud83d\ude49',
        ':speak_no_evil:': '\ud83d\ude4a',
        ':guardsman:': '\ud83d\udc82',
        ':skull:': '\ud83d\udc80',
        ':feet:': '\ud83d\udc63',
        ':lips:': '\ud83d\udc44',
        ':kiss:': '\ud83d\udc8b',
        ':droplet:': '\ud83d\udca7',
        ':ear:': '\ud83d\udc42',
        ':eyes:': '\ud83d\udc40',
        ':nose:': '\ud83d\udc43',
        ':tongue:': '\ud83d\udc45',
        ':love_letter:': '\ud83d\udc8c',
        ':bust_in_silhouette:': '\ud83d\udc64',
        ':busts_in_silhouette:': '\ud83d\udc65',
        ':speech_balloon:': '\ud83d\udcac',
        ':thought_balloon:': '\ud83d\udcad',
        ':sunny:': '\u2600',
        ':umbrella:': '\u2614',
        ':cloud:': '\u2601',
        ':snowflake:': '\u2744',
        ':snowman:': '\u26c4',
        ':zap:': '\u26a1',
        ':cyclone:': '\ud83c\udf00',
        ':foggy:': '\ud83c\udf01',
        ':ocean:': '\ud83c\udf0a',
        ':cat:': '\ud83d\udc31',
        ':dog:': '\ud83d\udc36',
        ':mouse:': '\ud83d\udc2d',
        ':hamster:': '\ud83d\udc39',
        ':rabbit:': '\ud83d\udc30',
        ':wolf:': '\ud83d\udc3a',
        ':frog:': '\ud83d\udc38',
        ':tiger:': '\ud83d\udc2f',
        ':koala:': '\ud83d\udc28',
        ':bear:': '\ud83d\udc3b',
        ':pig:': '\ud83d\udc37',
        ':pig_nose:': '\ud83d\udc3d',
        ':cow:': '\ud83d\udc2e',
        ':boar:': '\ud83d\udc17',
        ':monkey_face:': '\ud83d\udc35',
        ':monkey:': '\ud83d\udc12',
        ':horse:': '\ud83d\udc34',
        ':racehorse:': '\ud83d\udc0e',
        ':camel:': '\ud83d\udc2b',
        ':sheep:': '\ud83d\udc11',
        ':elephant:': '\ud83d\udc18',
        ':panda_face:': '\ud83d\udc3c',
        ':snake:': '\ud83d\udc0d',
        ':bird:': '\ud83d\udc26',
        ':baby_chick:': '\ud83d\udc24',
        ':hatched_chick:': '\ud83d\udc25',
        ':hatching_chick:': '\ud83d\udc23',
        ':chicken:': '\ud83d\udc14',
        ':penguin:': '\ud83d\udc27',
        ':turtle:': '\ud83d\udc22',
        ':bug:': '\ud83d\udc1b',
        ':honeybee:': '\ud83d\udc1d',
        ':ant:': '\ud83d\udc1c',
        ':beetle:': '\ud83d\udc1e',
        ':snail:': '\ud83d\udc0c',
        ':octopus:': '\ud83d\udc19',
        ':tropical_fish:': '\ud83d\udc20',
        ':fish:': '\ud83d\udc1f',
        ':whale:': '\ud83d\udc33',
        ':whale2:': '\ud83d\udc0b',
        ':dolphin:': '\ud83d\udc2c',
        ':cow2:': '\ud83d\udc04',
        ':ram:': '\ud83d\udc0f',
        ':rat:': '\ud83d\udc00',
        ':water_buffalo:': '\ud83d\udc03',
        ':tiger2:': '\ud83d\udc05',
        ':rabbit2:': '\ud83d\udc07',
        ':dragon:': '\ud83d\udc09',
        ':goat:': '\ud83d\udc10',
        ':rooster:': '\ud83d\udc13',
        ':dog2:': '\ud83d\udc15',
        ':pig2:': '\ud83d\udc16',
        ':mouse2:': '\ud83d\udc01',
        ':ox:': '\ud83d\udc02',
        ':dragon_face:': '\ud83d\udc32',
        ':blowfish:': '\ud83d\udc21',
        ':crocodile:': '\ud83d\udc0a',
        ':dromedary_camel:': '\ud83d\udc2a',
        ':leopard:': '\ud83d\udc06',
        ':cat2:': '\ud83d\udc08',
        ':poodle:': '\ud83d\udc29',
        ':paw_prints:': '\ud83d\udc3e',
        ':bouquet:': '\ud83d\udc90',
        ':cherry_blossom:': '\ud83c\udf38',
        ':tulip:': '\ud83c\udf37',
        ':four_leaf_clover:': '\ud83c\udf40',
        ':rose:': '\ud83c\udf39',
        ':sunflower:': '\ud83c\udf3b',
        ':hibiscus:': '\ud83c\udf3a',
        ':maple_leaf:': '\ud83c\udf41',
        ':leaves:': '\ud83c\udf43',
        ':fallen_leaf:': '\ud83c\udf42',
        ':herb:': '\ud83c\udf3f',
        ':mushroom:': '\ud83c\udf44',
        ':cactus:': '\ud83c\udf35',
        ':palm_tree:': '\ud83c\udf34',
        ':evergreen_tree:': '\ud83c\udf32',
        ':deciduous_tree:': '\ud83c\udf33',
        ':chestnut:': '\ud83c\udf30',
        ':seedling:': '\ud83c\udf31',
        ':blossom:': '\ud83c\udf3c',
        ':ear_of_rice:': '\ud83c\udf3e',
        ':shell:': '\ud83d\udc1a',
        ':globe_with_meridians:': '\ud83c\udf10',
        ':sun_with_face:': '\ud83c\udf1e',
        ':full_moon_with_face:': '\ud83c\udf1d',
        ':new_moon_with_face:': '\ud83c\udf1a',
        ':new_moon:': '\ud83c\udf11',
        ':waxing_crescent_moon:': '\ud83c\udf12',
        ':first_quarter_moon:': '\ud83c\udf13',
        ':waxing_gibbous_moon:': '\ud83c\udf14',
        ':full_moon:': '\ud83c\udf15',
        ':waning_gibbous_moon:': '\ud83c\udf16',
        ':last_quarter_moon:': '\ud83c\udf17',
        ':waning_crescent_moon:': '\ud83c\udf18',
        ':last_quarter_moon_with_face:': '\ud83c\udf1c',
        ':first_quarter_moon_with_face:': '\ud83c\udf1b',
        ':moon:': '\ud83c\udf19',
        ':earth_africa:': '\ud83c\udf0d',
        ':earth_americas:': '\ud83c\udf0e',
        ':earth_asia:': '\ud83c\udf0f',
        ':volcano:': '\ud83c\udf0b',
        ':milky_way:': '\ud83c\udf0c',
        ':partly_sunny:': '\u26c5',
        ':bamboo:': '\ud83c\udf8d',
        ':gift_heart:': '\ud83d\udc9d',
        ':dolls:': '\ud83c\udf8e',
        ':school_satchel:': '\ud83c\udf92',
        ':mortar_board:': '\ud83c\udf93',
        ':flags:': '\ud83c\udf8f',
        ':fireworks:': '\ud83c\udf86',
        ':sparkler:': '\ud83c\udf87',
        ':wind_chime:': '\ud83c\udf90',
        ':rice_scene:': '\ud83c\udf91',
        ':jack_o_lantern:': '\ud83c\udf83',
        ':ghost:': '\ud83d\udc7b',
        ':santa:': '\ud83c\udf85',
        ':8ball:': '\ud83c\udfb1',
        ':alarm_clock:': '\u23f0',
        ':apple:': '\ud83c\udf4e',
        ':art:': '\ud83c\udfa8',
        ':baby_bottle:': '\ud83c\udf7c',
        ':balloon:': '\ud83c\udf88',
        ':banana:': '\ud83c\udf4c',
        ':bar_chart:': '\ud83d\udcca',
        ':baseball:': '\u26be',
        ':basketball:': '\ud83c\udfc0',
        ':bath:': '\ud83d\udec0',
        ':bathtub:': '\ud83d\udec1',
        ':battery:': '\ud83d\udd0b',
        ':beer:': '\ud83c\udf7a',
        ':beers:': '\ud83c\udf7b',
        ':bell:': '\ud83d\udd14',
        ':bento:': '\ud83c\udf71',
        ':bicyclist:': '\ud83d\udeb4',
        ':bikini:': '\ud83d\udc59',
        ':birthday:': '\ud83c\udf82',
        ':black_joker:': '\ud83c\udccf',
        ':black_nib:': '\u2712',
        ':blue_book:': '\ud83d\udcd8',
        ':bomb:': '\ud83d\udca3',
        ':bookmark:': '\ud83d\udd16',
        ':bookmark_tabs:': '\ud83d\udcd1',
        ':books:': '\ud83d\udcda',
        ':boot:': '\ud83d\udc62',
        ':bowling:': '\ud83c\udfb3',
        ':bread:': '\ud83c\udf5e',
        ':briefcase:': '\ud83d\udcbc',
        ':bulb:': '\ud83d\udca1',
        ':cake:': '\ud83c\udf70',
        ':calendar:': '\ud83d\udcc6',
        ':calling:': '\ud83d\udcf2',
        ':camera:': '\ud83d\udcf7',
        ':candy:': '\ud83c\udf6c',
        ':card_index:': '\ud83d\udcc7',
        ':cd:': '\ud83d\udcbf',
        ':chart_with_downwards_trend:': '\ud83d\udcc9',
        ':chart_with_upwards_trend:': '\ud83d\udcc8',
        ':cherries:': '\ud83c\udf52',
        ':chocolate_bar:': '\ud83c\udf6b',
        ':christmas_tree:': '\ud83c\udf84',
        ':clapper:': '\ud83c\udfac',
        ':clipboard:': '\ud83d\udccb',
        ':closed_book:': '\ud83d\udcd5',
        ':closed_lock_with_key:': '\ud83d\udd10',
        ':closed_umbrella:': '\ud83c\udf02',
        ':clubs:': '\u2663',
        ':cocktail:': '\ud83c\udf78',
        ':coffee:': '\u2615',
        ':computer:': '\ud83d\udcbb',
        ':confetti_ball:': '\ud83c\udf8a',
        ':cookie:': '\ud83c\udf6a',
        ':corn:': '\ud83c\udf3d',
        ':credit_card:': '\ud83d\udcb3',
        ':crown:': '\ud83d\udc51',
        ':crystal_ball:': '\ud83d\udd2e',
        ':curry:': '\ud83c\udf5b',
        ':custard:': '\ud83c\udf6e',
        ':dango:': '\ud83c\udf61',
        ':dart:': '\ud83c\udfaf',
        ':date:': '\ud83d\udcc5',
        ':diamonds:': '\u2666',
        ':dollar:': '\ud83d\udcb5',
        ':door:': '\ud83d\udeaa',
        ':doughnut:': '\ud83c\udf69',
        ':dress:': '\ud83d\udc57',
        ':dvd:': '\ud83d\udcc0',
        ':e_mail:': '\ud83d\udce7',
        ':egg:': '\ud83c\udf73',
        ':eggplant:': '\ud83c\udf46',
        ':electric_plug:': '\ud83d\udd0c',
        ':email:': '\u2709',
        ':euro:': '\ud83d\udcb6',
        ':eyeglasses:': '\ud83d\udc53',
        ':fax:': '\ud83d\udce0',
        ':file_folder:': '\ud83d\udcc1',
        ':fish_cake:': '\ud83c\udf65',
        ':fishing_pole_and_fish:': '\ud83c\udfa3',
        ':flashlight:': '\ud83d\udd26',
        ':floppy_disk:': '\ud83d\udcbe',
        ':flower_playing_cards:': '\ud83c\udfb4',
        ':football:': '\ud83c\udfc8',
        ':fork_and_knife:': '\ud83c\udf74',
        ':fried_shrimp:': '\ud83c\udf64',
        ':fries:': '\ud83c\udf5f',
        ':game_die:': '\ud83c\udfb2',
        ':gem:': '\ud83d\udc8e',
        ':gift:': '\ud83c\udf81',
        ':golf:': '\u26f3',
        ':grapes:': '\ud83c\udf47',
        ':green_apple:': '\ud83c\udf4f',
        ':green_book:': '\ud83d\udcd7',
        ':guitar:': '\ud83c\udfb8',
        ':gun:': '\ud83d\udd2b',
        ':hamburger:': '\ud83c\udf54',
        ':hammer:': '\ud83d\udd28',
        ':handbag:': '\ud83d\udc5c',
        ':headphones:': '\ud83c\udfa7',
        ':hearts:': '\u2665',
        ':high_brightness:': '\ud83d\udd06',
        ':high_heel:': '\ud83d\udc60',
        ':hocho:': '\ud83d\udd2a',
        ':honey_pot:': '\ud83c\udf6f',
        ':horse_racing:': '\ud83c\udfc7',
        ':hourglass:': '\u231b',
        ':hourglass_flowing_sand:': '\u23f3',
        ':ice_cream:': '\ud83c\udf68',
        ':icecream:': '\ud83c\udf66',
        ':inbox_tray:': '\ud83d\udce5',
        ':incoming_envelope:': '\ud83d\udce8',
        ':iphone:': '\ud83d\udcf1',
        ':jeans:': '\ud83d\udc56',
        ':key:': '\ud83d\udd11',
        ':kimono:': '\ud83d\udc58',
        ':ledger:': '\ud83d\udcd2',
        ':lemon:': '\ud83c\udf4b',
        ':lipstick:': '\ud83d\udc84',
        ':lock:': '\ud83d\udd12',
        ':lock_with_ink_pen:': '\ud83d\udd0f',
        ':lollipop:': '\ud83c\udf6d',
        ':loop:': '\u27bf',
        ':loudspeaker:': '\ud83d\udce2',
        ':low_brightness:': '\ud83d\udd05',
        ':mag:': '\ud83d\udd0d',
        ':mag_right:': '\ud83d\udd0e',
        ':mahjong:': '\ud83c\udc04',
        ':mailbox:': '\ud83d\udceb',
        ':mailbox_closed:': '\ud83d\udcea',
        ':mailbox_with_mail:': '\ud83d\udcec',
        ':mailbox_with_no_mail:': '\ud83d\udced',
        ':mans_shoe:': '\ud83d\udc5e',
        ':meat_on_bone:': '\ud83c\udf56',
        ':mega:': '\ud83d\udce3',
        ':melon:': '\ud83c\udf48',
        ':memo:': '\ud83d\udcdd',
        ':microphone:': '\ud83c\udfa4',
        ':microscope:': '\ud83d\udd2c',
        ':minidisc:': '\ud83d\udcbd',
        ':money_with_wings:': '\ud83d\udcb8',
        ':moneybag:': '\ud83d\udcb0',
        ':mountain_bicyclist:': '\ud83d\udeb5',
        ':movie_camera:': '\ud83c\udfa5',
        ':musical_keyboard:': '\ud83c\udfb9',
        ':musical_score:': '\ud83c\udfbc',
        ':mute:': '\ud83d\udd07',
        ':name_badge:': '\ud83d\udcdb',
        ':necktie:': '\ud83d\udc54',
        ':newspaper:': '\ud83d\udcf0',
        ':no_bell:': '\ud83d\udd15',
        ':notebook:': '\ud83d\udcd3',
        ':notebook_with_decorative_cover:': '\ud83d\udcd4',
        ':nut_and_bolt:': '\ud83d\udd29',
        ':oden:': '\ud83c\udf62',
        ':open_file_folder:': '\ud83d\udcc2',
        ':orange_book:': '\ud83d\udcd9',
        ':outbox_tray:': '\ud83d\udce4',
        ':page_facing_up:': '\ud83d\udcc4',
        ':page_with_curl:': '\ud83d\udcc3',
        ':pager:': '\ud83d\udcdf',
        ':paperclip:': '\ud83d\udcce',
        ':peach:': '\ud83c\udf51',
        ':pear:': '\ud83c\udf50',
        ':pencil2:': '\u270f',
        ':phone:': '\u260e',
        ':pill:': '\ud83d\udc8a',
        ':pineapple:': '\ud83c\udf4d',
        ':pizza:': '\ud83c\udf55',
        ':postal_horn:': '\ud83d\udcef',
        ':postbox:': '\ud83d\udcee',
        ':pouch:': '\ud83d\udc5d',
        ':poultry_leg:': '\ud83c\udf57',
        ':pound:': '\ud83d\udcb7',
        ':purse:': '\ud83d\udc5b',
        ':pushpin:': '\ud83d\udccc',
        ':radio:': '\ud83d\udcfb',
        ':ramen:': '\ud83c\udf5c',
        ':ribbon:': '\ud83c\udf80',
        ':rice:': '\ud83c\udf5a',
        ':rice_ball:': '\ud83c\udf59',
        ':rice_cracker:': '\ud83c\udf58',
        ':ring:': '\ud83d\udc8d',
        ':rugby_football:': '\ud83c\udfc9',
        ':running_shirt_with_sash:': '\ud83c\udfbd',
        ':sake:': '\ud83c\udf76',
        ':sandal:': '\ud83d\udc61',
        ':satellite:': '\ud83d\udce1',
        ':saxophone:': '\ud83c\udfb7',
        ':scissors:': '\u2702',
        ':scroll:': '\ud83d\udcdc',
        ':seat:': '\ud83d\udcba',
        ':shaved_ice:': '\ud83c\udf67',
        ':shirt:': '\ud83d\udc55',
        ':shower:': '\ud83d\udebf',
        ':ski:': '\ud83c\udfbf',
        ':smoking:': '\ud83d\udeac',
        ':snowboarder:': '\ud83c\udfc2',
        ':soccer:': '\u26bd',
        ':sound:': '\ud83d\udd09',
        ':space_invader:': '\ud83d\udc7e',
        ':spades:': '\u2660',
        ':spaghetti:': '\ud83c\udf5d',
        ':speaker:': '\ud83d\udd0a',
        ':stew:': '\ud83c\udf72',
        ':straight_ruler:': '\ud83d\udccf',
        ':strawberry:': '\ud83c\udf53',
        ':surfer:': '\ud83c\udfc4',
        ':sushi:': '\ud83c\udf63',
        ':sweet_potato:': '\ud83c\udf60',
        ':swimmer:': '\ud83c\udfca',
        ':syringe:': '\ud83d\udc89',
        ':tada:': '\ud83c\udf89',
        ':tanabata_tree:': '\ud83c\udf8b',
        ':tangerine:': '\ud83c\udf4a',
        ':tea:': '\ud83c\udf75',
        ':telephone_receiver:': '\ud83d\udcde',
        ':telescope:': '\ud83d\udd2d',
        ':tennis:': '\ud83c\udfbe',
        ':toilet:': '\ud83d\udebd',
        ':tomato:': '\ud83c\udf45',
        ':tophat:': '\ud83c\udfa9',
        ':triangular_ruler:': '\ud83d\udcd0',
        ':trophy:': '\ud83c\udfc6',
        ':tropical_drink:': '\ud83c\udf79',
        ':trumpet:': '\ud83c\udfba',
        ':tv:': '\ud83d\udcfa',
        ':unlock:': '\ud83d\udd13',
        ':vhs:': '\ud83d\udcfc',
        ':video_camera:': '\ud83d\udcf9',
        ':video_game:': '\ud83c\udfae',
        ':violin:': '\ud83c\udfbb',
        ':watch:': '\u231a',
        ':watermelon:': '\ud83c\udf49',
        ':wine_glass:': '\ud83c\udf77',
        ':womans_clothes:': '\ud83d\udc5a',
        ':womans_hat:': '\ud83d\udc52',
        ':wrench:': '\ud83d\udd27',
        ':yen:': '\ud83d\udcb4',
        ':aerial_tramway:': '\ud83d\udea1',
        ':airplane:': '\u2708',
        ':ambulance:': '\ud83d\ude91',
        ':anchor:': '\u2693',
        ':articulated_lorry:': '\ud83d\ude9b',
        ':atm:': '\ud83c\udfe7',
        ':bank:': '\ud83c\udfe6',
        ':barber:': '\ud83d\udc88',
        ':beginner:': '\ud83d\udd30',
        ':bike:': '\ud83d\udeb2',
        ':blue_car:': '\ud83d\ude99',
        ':boat:': '\u26f5',
        ':bridge_at_night:': '\ud83c\udf09',
        ':bullettrain_front:': '\ud83d\ude85',
        ':bullettrain_side:': '\ud83d\ude84',
        ':bus:': '\ud83d\ude8c',
        ':busstop:': '\ud83d\ude8f',
        ':car:': '\ud83d\ude97',
        ':carousel_horse:': '\ud83c\udfa0',
        ':checkered_flag:': '\ud83c\udfc1',
        ':church:': '\u26ea',
        ':circus_tent:': '\ud83c\udfaa',
        ':city_sunrise:': '\ud83c\udf07',
        ':city_sunset:': '\ud83c\udf06',
        ':construction:': '\ud83d\udea7',
        ':convenience_store:': '\ud83c\udfea',
        ':crossed_flags:': '\ud83c\udf8c',
        ':department_store:': '\ud83c\udfec',
        ':european_castle:': '\ud83c\udff0',
        ':european_post_office:': '\ud83c\udfe4',
        ':factory:': '\ud83c\udfed',
        ':ferris_wheel:': '\ud83c\udfa1',
        ':fire_engine:': '\ud83d\ude92',
        ':fountain:': '\u26f2',
        ':fuelpump:': '\u26fd',
        ':helicopter:': '\ud83d\ude81',
        ':hospital:': '\ud83c\udfe5',
        ':hotel:': '\ud83c\udfe8',
        ':hotsprings:': '\u2668',
        ':house:': '\ud83c\udfe0',
        ':house_with_garden:': '\ud83c\udfe1',
        ':japan:': '\ud83d\uddfe',
        ':japanese_castle:': '\ud83c\udfef',
        ':light_rail:': '\ud83d\ude88',
        ':love_hotel:': '\ud83c\udfe9',
        ':minibus:': '\ud83d\ude90',
        ':monorail:': '\ud83d\ude9d',
        ':mount_fuji:': '\ud83d\uddfb',
        ':mountain_cableway:': '\ud83d\udea0',
        ':mountain_railway:': '\ud83d\ude9e',
        ':moyai:': '\ud83d\uddff',
        ':office:': '\ud83c\udfe2',
        ':oncoming_automobile:': '\ud83d\ude98',
        ':oncoming_bus:': '\ud83d\ude8d',
        ':oncoming_police_car:': '\ud83d\ude94',
        ':oncoming_taxi:': '\ud83d\ude96',
        ':performing_arts:': '\ud83c\udfad',
        ':police_car:': '\ud83d\ude93',
        ':post_office:': '\ud83c\udfe3',
        ':railway_car:': '\ud83d\ude83',
        ':rainbow:': '\ud83c\udf08',
        ':rocket:': '\ud83d\ude80',
        ':roller_coaster:': '\ud83c\udfa2',
        ':rotating_light:': '\ud83d\udea8',
        ':round_pushpin:': '\ud83d\udccd',
        ':rowboat:': '\ud83d\udea3',
        ':school:': '\ud83c\udfeb',
        ':ship:': '\ud83d\udea2',
        ':slot_machine:': '\ud83c\udfb0',
        ':speedboat:': '\ud83d\udea4',
        ':stars:': '\ud83c\udf03',
        ':station:': '\ud83d\ude89',
        ':statue_of_liberty:': '\ud83d\uddfd',
        ':steam_locomotive:': '\ud83d\ude82',
        ':sunrise:': '\ud83c\udf05',
        ':sunrise_over_mountains:': '\ud83c\udf04',
        ':suspension_railway:': '\ud83d\ude9f',
        ':taxi:': '\ud83d\ude95',
        ':tent:': '\u26fa',
        ':ticket:': '\ud83c\udfab',
        ':tokyo_tower:': '\ud83d\uddfc',
        ':tractor:': '\ud83d\ude9c',
        ':traffic_light:': '\ud83d\udea5',
        ':train2:': '\ud83d\ude86',
        ':tram:': '\ud83d\ude8a',
        ':triangular_flag_on_post:': '\ud83d\udea9',
        ':trolleybus:': '\ud83d\ude8e',
        ':truck:': '\ud83d\ude9a',
        ':vertical_traffic_light:': '\ud83d\udea6',
        ':warning:': '\u26a0',
        ':wedding:': '\ud83d\udc92',
        ':100:': '\ud83d\udcaf',
        ':1234:': '\ud83d\udd22',
        ':a:': '\ud83c\udd70',
        ':ab:': '\ud83c\udd8e',
        ':abc:': '\ud83d\udd24',
        ':abcd:': '\ud83d\udd21',
        ':accept:': '\ud83c\ude51',
        ':aquarius:': '\u2652',
        ':aries:': '\u2648',
        ':arrow_backward:': '\u25c0',
        ':arrow_double_down:': '\u23ec',
        ':arrow_double_up:': '\u23eb',
        ':arrow_down:': '\u2b07',
        ':arrow_down_small:': '\ud83d\udd3d',
        ':arrow_forward:': '\u25b6',
        ':arrow_heading_down:': '\u2935',
        ':arrow_heading_up:': '\u2934',
        ':arrow_left:': '\u2b05',
        ':arrow_lower_left:': '\u2199',
        ':arrow_lower_right:': '\u2198',
        ':arrow_right:': '\u27a1',
        ':arrow_right_hook:': '\u21aa',
        ':arrow_up:': '\u2b06',
        ':arrow_up_down:': '\u2195',
        ':arrow_up_small:': '\ud83d\udd3c',
        ':arrow_upper_left:': '\u2196',
        ':arrow_upper_right:': '\u2197',
        ':arrows_clockwise:': '\ud83d\udd03',
        ':arrows_counterclockwise:': '\ud83d\udd04',
        ':b:': '\ud83c\udd71',
        ':baby_symbol:': '\ud83d\udebc',
        ':baggage_claim:': '\ud83d\udec4',
        ':ballot_box_with_check:': '\u2611',
        ':bangbang:': '\u203c',
        ':black_circle:': '\u26ab',
        ':black_square_button:': '\ud83d\udd32',
        ':cancer:': '\u264b',
        ':capital_abcd:': '\ud83d\udd20',
        ':capricorn:': '\u2651',
        ':chart:': '\ud83d\udcb9',
        ':children_crossing:': '\ud83d\udeb8',
        ':cinema:': '\ud83c\udfa6',
        ':cl:': '\ud83c\udd91',
        ':clock1:': '\ud83d\udd50',
        ':clock10:': '\ud83d\udd59',
        ':clock1030:': '\ud83d\udd65',
        ':clock11:': '\ud83d\udd5a',
        ':clock1130:': '\ud83d\udd66',
        ':clock12:': '\ud83d\udd5b',
        ':clock1230:': '\ud83d\udd67',
        ':clock130:': '\ud83d\udd5c',
        ':clock2:': '\ud83d\udd51',
        ':clock230:': '\ud83d\udd5d',
        ':clock3:': '\ud83d\udd52',
        ':clock330:': '\ud83d\udd5e',
        ':clock4:': '\ud83d\udd53',
        ':clock430:': '\ud83d\udd5f',
        ':clock5:': '\ud83d\udd54',
        ':clock530:': '\ud83d\udd60',
        ':clock6:': '\ud83d\udd55',
        ':clock630:': '\ud83d\udd61',
        ':clock7:': '\ud83d\udd56',
        ':clock730:': '\ud83d\udd62',
        ':clock8:': '\ud83d\udd57',
        ':clock830:': '\ud83d\udd63',
        ':clock9:': '\ud83d\udd58',
        ':clock930:': '\ud83d\udd64',
        ':congratulations:': '\u3297',
        ':cool:': '\ud83c\udd92',
        ':curly_loop:': '\u27b0',
        ':currency_exchange:': '\ud83d\udcb1',
        ':customs:': '\ud83d\udec3',
        ':diamond_shape_with_a_dot_inside:': '\ud83d\udca0',
        ':do_not_litter:': '\ud83d\udeaf',
        ':eight_pointed_black_star:': '\u2734',
        ':eight_spoked_asterisk:': '\u2733',
        ':end:': '\ud83d\udd1a',
        ':fast_forward:': '\u23e9',
        ':free:': '\ud83c\udd93',
        ':gemini:': '\u264a',
        ':heart_decoration:': '\ud83d\udc9f',
        ':heavy_check_mark:': '\u2714',
        ':heavy_division_sign:': '\u2797',
        ':heavy_dollar_sign:': '\ud83d\udcb2',
        ':heavy_minus_sign:': '\u2796',
        ':heavy_multiplication_x:': '\u2716',
        ':heavy_plus_sign:': '\u2795',
        ':id:': '\ud83c\udd94',
        ':ideograph_advantage:': '\ud83c\ude50',
        ':information_source:': '\u2139',
        ':interrobang:': '\u2049',
        ':keycap_ten:': '\ud83d\udd1f',
        ':koko:': '\ud83c\ude01',
        ':large_blue_circle:': '\ud83d\udd35',
        ':large_blue_diamond:': '\ud83d\udd37',
        ':large_orange_diamond:': '\ud83d\udd36',
        ':left_luggage:': '\ud83d\udec5',
        ':left_right_arrow:': '\u2194',
        ':leftwards_arrow_with_hook:': '\u21a9',
        ':leo:': '\u264c',
        ':libra:': '\u264e',
        ':link:': '\ud83d\udd17',
        ':m:': '\u24c2',
        ':mens:': '\ud83d\udeb9',
        ':metro:': '\ud83d\ude87',
        ':mobile_phone_off:': '\ud83d\udcf4',
        ':negative_squared_cross_mark:': '\u274e',
        ':new:': '\ud83c\udd95',
        ':ng:': '\ud83c\udd96',
        ':no_bicycles:': '\ud83d\udeb3',
        ':no_entry:': '\u26d4',
        ':no_entry_sign:': '\ud83d\udeab',
        ':no_mobile_phones:': '\ud83d\udcf5',
        ':no_pedestrians:': '\ud83d\udeb7',
        ':no_smoking:': '\ud83d\udead',
        ':non_potable_water:': '\ud83d\udeb1',
        ':o:': '\u2b55',
        ':o2:': '\ud83c\udd7e',
        ':ok:': '\ud83c\udd97',
        ':on:': '\ud83d\udd1b',
        ':ophiuchus:': '\u26ce',
        ':parking:': '\ud83c\udd7f',
        ':part_alternation_mark:': '\u303d',
        ':passport_control:': '\ud83d\udec2',
        ':pisces:': '\u2653',
        ':potable_water:': '\ud83d\udeb0',
        ':put_litter_in_its_place:': '\ud83d\udeae',
        ':radio_button:': '\ud83d\udd18',
        ':recycle:': '\u267b',
        ':red_circle:': '\ud83d\udd34',
        ':repeat:': '\ud83d\udd01',
        ':repeat_one:': '\ud83d\udd02',
        ':restroom:': '\ud83d\udebb',
        ':rewind:': '\u23ea',
        ':sa:': '\ud83c\ude02',
        ':sagittarius:': '\u2650',
        ':scorpius:': '\u264f',
        ':secret:': '\u3299',
        ':signal_strength:': '\ud83d\udcf6',
        ':six_pointed_star:': '\ud83d\udd2f',
        ':small_blue_diamond:': '\ud83d\udd39',
        ':small_orange_diamond:': '\ud83d\udd38',
        ':small_red_triangle:': '\ud83d\udd3a',
        ':small_red_triangle_down:': '\ud83d\udd3b',
        ':soon:': '\ud83d\udd1c',
        ':sos:': '\ud83c\udd98',
        ':symbols:': '\ud83d\udd23',
        ':taurus:': '\u2649',
        ':tm:': '\u2122',
        ':top:': '\ud83d\udd1d',
        ':trident:': '\ud83d\udd31',
        ':twisted_rightwards_arrows:': '\ud83d\udd00',
        ':u5272:': '\ud83c\ude39',
        ':u5408:': '\ud83c\ude34',
        ':u55b6:': '\ud83c\ude3a',
        ':u6307:': '\ud83c\ude2f',
        ':u6708:': '\ud83c\ude37',
        ':u6709:': '\ud83c\ude36',
        ':u6e80:': '\ud83c\ude35',
        ':u7121:': '\ud83c\ude1a',
        ':u7533:': '\ud83c\ude38',
        ':u7981:': '\ud83c\ude32',
        ':u7a7a:': '\ud83c\ude33',
        ':underage:': '\ud83d\udd1e',
        ':up:': '\ud83c\udd99',
        ':vibration_mode:': '\ud83d\udcf3',
        ':virgo:': '\u264d',
        ':vs:': '\ud83c\udd9a',
        ':wavy_dash:': '\u3030',
        ':wc:': '\ud83d\udebe',
        ':wheelchair:': '\u267f',
        ':white_check_mark:': '\u2705',
        ':white_circle:': '\u26aa',
        ':white_flower:': '\ud83d\udcae',
        ':white_square_button:': '\ud83d\udd33',
        ':womens:': '\ud83d\udeba',
        ':x:': '\u274c'
    });

function EmojiService(emojiMap, str) {
    // Taken from: https://github.com/frissdiegurke/emoji-parser/blob/master/lib/parse.coffee
    var emojiRegex = /\:([a-z0-9_+-]+)(?:\[((?:[^\]]|\][^:])*\]?)\])?\:/g;
    var matches = str.match(emojiRegex);
    if (matches !== null) {
        for (var i = 0; i < matches.length; i++) {
            var key = matches[i];
            if (emojiMap[key]) {
                str = str.replace(key, emojiMap[key]);
            }
        }
    }
    return str;
}
